<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WalletNotebook Admin Panel</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #4361ee;
        --primary-dark: #3a56d4;
        --secondary: #7209b7;
        --success: #4cc9f0;
        --danger: #f72585;
        --warning: #f8961e;
        --dark: #212529;
        --light: #f8f9fa;
        --gray: #6c757d;
        --gray-light: #e9ecef;
        --border-radius: 8px;
        --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f5f7fb;
        color: var(--dark);
        line-height: 1.6;
      }

      .container {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar Styles */
      .sidebar {
        width: 260px;
        background: linear-gradient(
          180deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        padding: 25px 0;
        box-shadow: var(--box-shadow);
        z-index: 10;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
      }

      .logo {
        display: flex;
        align-items: center;
        padding: 0 25px 30px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 25px;
      }

      .logo i {
        font-size: 28px;
        margin-right: 12px;
      }

      .logo h1 {
        font-size: 22px;
        font-weight: 700;
      }

      .nav-item {
        padding: 14px 25px;
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: var(--transition);
        border-left: 3px solid transparent;
      }

      .nav-item:hover,
      .nav-item.active {
        background-color: rgba(255, 255, 255, 0.1);
        border-left: 3px solid var(--success);
      }

      .nav-item i {
        width: 24px;
        margin-right: 12px;
        font-size: 18px;
      }

      .nav-text {
        font-size: 16px;
        font-weight: 500;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 260px;
        padding: 30px;
        width: calc(100% - 260px);
      }

      .header {
        display: flex;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--gray-light);
      }

      .header h2 {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary);
      }

      .header-actions {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .connect-btn {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: var(--border-radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .connect-btn:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
      }

      .network-info {
        background-color: var(--gray-light);
        padding: 8px 16px;
        border-radius: var(--border-radius);
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* Dashboard Cards */
      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .card {
        background-color: white;
        border-radius: var(--border-radius);
        padding: 25px;
        box-shadow: var(--box-shadow);
        transition: var(--transition);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .card-1 .card-icon {
        background-color: rgba(67, 97, 238, 0.15);
        color: var(--primary);
      }
      .card-2 .card-icon {
        background-color: rgba(114, 9, 183, 0.15);
        color: var(--secondary);
      }
      .card-3 .card-icon {
        background-color: rgba(76, 201, 240, 0.15);
        color: var(--success);
      }
      .card-4 .card-icon {
        background-color: rgba(248, 150, 30, 0.15);
        color: var(--warning);
      }

      .card-value {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .card-label {
        font-size: 14px;
        color: var(--gray);
        font-weight: 500;
      }

      /* Content Sections */
      .content-section {
        display: none;
        background-color: white;
        border-radius: var(--border-radius);
        padding: 30px;
        box-shadow: var(--box-shadow);
        margin-bottom: 30px;
      }

      .content-section.active {
        display: block;
      }

      .section-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 25px;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .section-title i {
        font-size: 24px;
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 20px;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
      }

      input,
      textarea {
        width: 100%;
        padding: 14px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
        font-size: 16px;
        transition: var(--transition);
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      }

      textarea {
        min-height: 120px;
        resize: vertical;
      }

      .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
      }

      .btn {
        padding: 14px 28px;
        border-radius: var(--border-radius);
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-primary {
        background-color: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-dark);
      }

      .btn-secondary {
        background-color: var(--gray-light);
        color: var(--dark);
      }

      .btn-secondary:hover {
        background-color: #dde0e4;
      }

      .btn-success {
        background-color: var(--success);
        color: white;
      }

      .btn-success:hover {
        background-color: #3db8da;
      }

      .btn-danger {
        background-color: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background-color: #e11575;
      }

      /* Table Styles */
      .table-container {
        overflow-x: auto;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--gray-light);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background-color: var(--primary);
        color: white;
      }

      th {
        padding: 18px 16px;
        text-align: left;
        font-weight: 600;
        font-size: 16px;
      }

      tbody tr {
        border-bottom: 1px solid var(--gray-light);
        transition: var(--transition);
      }

      tbody tr:hover {
        background-color: rgba(67, 97, 238, 0.05);
      }

      td {
        padding: 16px;
        font-size: 15px;
      }

      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
        border: none;
        color: white;
        font-size: 14px;
      }

      .action-btn.view {
        background-color: var(--success);
      }

      .action-btn.edit {
        background-color: var(--warning);
      }

      .action-btn.delete {
        background-color: var(--danger);
      }

      .action-btn:hover {
        transform: translateY(-2px);
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 100;
        justify-content: center;
        align-items: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background-color: white;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 700px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        padding: 25px 30px;
        border-bottom: 1px solid var(--gray-light);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-title {
        font-size: 22px;
        font-weight: 700;
        color: var(--primary);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--gray);
        transition: var(--transition);
      }

      .modal-close:hover {
        color: var(--danger);
      }

      .modal-body {
        padding: 30px;
      }

      .entry-detail {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
      }

      .detail-item {
        margin-bottom: 15px;
      }

      .detail-label {
        font-weight: 600;
        color: var(--gray);
        font-size: 14px;
        margin-bottom: 5px;
      }

      .detail-value {
        font-size: 16px;
        word-break: break-all;
        padding: 10px 15px;
        background-color: var(--gray-light);
        border-radius: var(--border-radius);
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .sidebar {
          width: 80px;
        }

        .main-content {
          margin-left: 80px;
          width: calc(100% - 80px);
        }

        .logo h1,
        .nav-text {
          display: none;
        }

        .logo {
          justify-content: center;
          padding: 0 0 30px;
        }

        .logo i {
          margin-right: 0;
          font-size: 32px;
        }

        .nav-item {
          justify-content: center;
          padding: 18px 0;
        }

        .nav-item i {
          margin-right: 0;
          font-size: 22px;
        }
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 20px;
        }

        .dashboard-cards {
          grid-template-columns: repeat(2, 1fr);
        }

        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }

        .header-actions {
          width: 100%;
          flex-direction: column;
          align-items: flex-start;
        }

        .form-row {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 576px) {
        .dashboard-cards {
          grid-template-columns: 1fr;
        }

        .action-buttons {
          flex-direction: column;
          gap: 5px;
        }

        .btn {
          width: 100%;
        }

        .form-actions {
          flex-direction: column;
        }
      }

      /* Notifications */
      .notification {
        position: fixed;
        top: 30px;
        right: 30px;
        padding: 18px 24px;
        border-radius: var(--border-radius);
        color: white;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: var(--box-shadow);
        z-index: 1000;
        transform: translateX(150%);
        transition: transform 0.4s ease;
        max-width: 400px;

        overflow-y: auto;
      }

      #notification-text {
        max-width: 300px;
        overflow: atuo;
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification.success {
        background-color: var(--success);
      }

      .notification.error {
        background-color: var(--danger);
      }

      .notification.info {
        background-color: var(--primary);
      }

      .notification.warning {
        background-color: var(--warning);
      }

      .badge-cell {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .badge {
        background-color: #2d7ef7;
        color: #fff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
      }

      /* Loading Spinner */
      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="logo">
          <i class="fas fa-wallet"></i>
          <h1>WalletNotebook</h1>
        </div>
        <div class="nav-item active" data-section="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span class="nav-text">Dashboard</span>
        </div>
        <div class="nav-item" data-section="create-entry">
          <i class="fas fa-plus-circle"></i>
          <span class="nav-text">Create Entry</span>
        </div>
        <div class="nav-item" data-section="view-entries">
          <i class="fas fa-list"></i>
          <span class="nav-text">View All Entries</span>
        </div>
        <div class="nav-item" data-section="update-entry">
          <i class="fas fa-edit"></i>
          <span class="nav-text">Update Entry</span>
        </div>
        <div class="nav-item" data-section="contract-info">
          <i class="fas fa-info-circle"></i>
          <span class="nav-text">Contract Info</span>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Header -->
        <div class="header">
          <h2>WalletNotebook Admin Panel</h2>
          &nbsp;&nbsp; &nbsp;&nbsp;
          <div class="header-actions">
            <div class="network-info">
              <i class="fas fa-network-wired"></i>
              <span id="network-name">Not Connected</span>
            </div>
            <button class="connect-btn" id="connect-wallet">
              <i class="fas fa-plug"></i>
              <span>Connect Wallet</span>
            </button>
          </div>
        </div>

        <!-- Dashboard -->
        <div class="content-section active" id="dashboard">
          <h3 class="section-title">
            <i class="fas fa-tachometer-alt"></i> Dashboard Overview
          </h3>

          <div class="dashboard-cards">
            <div class="card card-1">
              <div class="card-header">
                <div>
                  <div class="card-value" id="total-entries">0</div>
                  <div class="card-label">Total Entries</div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-wallet"></i>
                </div>
              </div>
            </div>

            <div class="card card-2">
              <div class="card-header">
                <div>
                  <div class="card-value" id="contract-owner">...</div>
                  <div class="card-label">Contract Owner</div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-user-shield"></i>
                </div>
              </div>
            </div>

            <div class="card card-3">
              <div class="card-header">
                <div>
                  <div class="card-value" id="connected-address">
                    Not Connected
                  </div>
                  <div class="card-label">Your Address</div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-address-card"></i>
                </div>
              </div>
            </div>

            <div class="card card-4">
              <div class="card-header">
                <div>
                  <div class="card-value" id="last-updated">0</div>
                  <div class="card-label">Last Updated</div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-history"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="content-section" style="margin-top: 20px; padding: 20px">
            <h4>Quick Actions</h4>
            <div style="display: flex; gap: 15px; margin-top: 20px">
              <button class="btn btn-primary" data-section="create-entry">
                <i class="fas fa-plus"></i> Create New Entry
              </button>
              <button class="btn btn-success" data-section="view-entries">
                <i class="fas fa-list"></i> View All Entries
              </button>
              <button class="btn btn-secondary" id="refresh-data">
                <i class="fas fa-sync-alt"></i> Refresh Data
              </button>
            </div>
          </div>
        </div>

        <!-- Create Entry -->
        <div class="content-section" id="create-entry">
          <h3 class="section-title">
            <i class="fas fa-plus-circle"></i> Create New Entry
          </h3>

          <form id="create-entry-form">
            <div class="form-row">
              <div class="form-group">
                <label for="create-title">Title *</label>
                <input
                  type="text"
                  id="create-title"
                  placeholder="Entry title"
                  required
                />
              </div>
              <div class="form-group">
                <label for="create-address1">Address 1 (Ethereum) *</label>
                <input
                  type="text"
                  id="create-address1"
                  placeholder="0x..."
                  required
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="create-address2">Address 2 (Any)</label>
                <input
                  type="text"
                  id="create-address2"
                  placeholder="Alternative address or identifier"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="create-notes">Notes</label>
                <textarea
                  id="create-notes"
                  placeholder="Add notes about this entry"
                ></textarea>
              </div>
              <div class="form-group">
                <label for="create-etcInfo">Additional Information</label>
                <textarea
                  id="create-etcInfo"
                  placeholder="Any additional information"
                ></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Create Entry
              </button>
              <button type="reset" class="btn btn-secondary">
                <i class="fas fa-times"></i> Clear Form
              </button>
            </div>
          </form>
        </div>

        <!-- View All Entries -->
        <div class="content-section" id="view-entries">
          <h3 class="section-title">
            <i class="fas fa-list"></i> All Wallet Entries
          </h3>

          <div class="table-container">
            <table id="entries-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Address 1</th>
                  <th>Private key</th>
                  <th>Notes</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="entries-table-body">
                <tr>
                  <td colspan="5" style="text-align: center; padding: 40px">
                    <div style="color: var(--gray)">
                      <i
                        class="fas fa-spinner fa-spin"
                        style="font-size: 24px; margin-bottom: 15px"
                      ></i>
                      <div>Loading entries...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="form-actions" style="margin-top: 20px">
            <button class="btn btn-success" id="refresh-entries">
              <i class="fas fa-sync-alt"></i> Refresh Entries
            </button>
          </div>
        </div>

        <!-- Update Entry -->
        <div class="content-section" id="update-entry">
          <h3 class="section-title">
            <i class="fas fa-edit"></i> Update Entry
          </h3>

          <div class="form-group">
            <label for="update-entry-id">Entry ID *</label>
            <input
              type="number"
              id="update-entry-id"
              placeholder="Enter entry ID to update"
              min="0"
            />
            <button
              class="btn btn-secondary"
              id="load-entry-btn"
              style="margin-top: 10px"
            >
              <i class="fas fa-search"></i> Load Entry Details
            </button>
          </div>

          <div id="update-entry-details" style="display: none">
            <div class="detail-item">
              <div class="detail-label">Title</div>
              <div class="detail-value" id="update-display-title"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Address 1</div>
              <div class="detail-value" id="update-display-address1"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Address 2</div>
              <div class="detail-value" id="update-display-address2"></div>
            </div>

            <form id="update-entry-form" style="margin-top: 30px">
              <div class="form-row">
                <div class="form-group">
                  <label for="update-notes">Notes</label>
                  <textarea
                    id="update-notes"
                    placeholder="Update notes"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="update-etcInfo">Additional Information</label>
                  <textarea
                    id="update-etcInfo"
                    placeholder="Update additional information"
                  ></textarea>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i> Update Entry
                </button>
                <button type="reset" class="btn btn-secondary">
                  <i class="fas fa-times"></i> Reset Form
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Contract Info -->
        <div class="content-section" id="contract-info">
          <h3 class="section-title">
            <i class="fas fa-info-circle"></i> Contract Information
          </h3>

          <div class="entry-detail">
            <div class="detail-item">
              <div class="detail-label">Contract Address</div>
              <div class="detail-value" id="contract-address">
                Not connected
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Contract Owner</div>
              <div class="detail-value" id="info-contract-owner">...</div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Your Address</div>
              <div class="detail-value" id="info-connected-address">
                Not connected
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Network</div>
              <div class="detail-value" id="info-network-name">
                Not connected
              </div>
            </div>
          </div>

          <div class="detail-item" style="margin-top: 30px">
            <div class="detail-label">Contract ABI</div>
            <div
              class="detail-value"
              style="font-size: 12px; max-height: 200px; overflow-y: auto"
            >
              [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"EntryCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"EntryUpdated","type":"event"},{"inputs":[{"internalType":"string","name":"_title","type":"string"},{"internalType":"address","name":"_address1","type":"address"},{"internalType":"string","name":"_address2","type":"string"},{"internalType":"string","name":"_notes","type":"string"},{"internalType":"string","name":"_etcInfo","type":"string"}],"name":"createEntry","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAllEntries","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"title","type":"string"},{"internalType":"address","name":"address1","type":"address"},{"internalType":"string","name":"address2","type":"string"},{"internalType":"string","name":"notes","type":"string"},{"internalType":"string","name":"etcInfo","type":"string"},{"internalType":"bool","name":"exists","type":"bool"}],"internalType":"struct
              WalletNotebook.Entry[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_id","type":"uint256"}],"name":"getEntry","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"title","type":"string"},{"internalType":"address","name":"address1","type":"address"},{"internalType":"string","name":"address2","type":"string"},{"internalType":"string","name":"notes","type":"string"},{"internalType":"string","name":"etcInfo","type":"string"},{"internalType":"bool","name":"exists","type":"bool"}],"internalType":"struct
              WalletNotebook.Entry","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_id","type":"uint256"},{"internalType":"string","name":"_notes","type":"string"},{"internalType":"string","name":"_etcInfo","type":"string"}],"name":"updateEntry","outputs":[],"stateMutability":"nonpayable","type":"function"}]
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Entry Detail Modal -->
    <div class="modal" id="entry-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Entry Details</h3>
          <button class="modal-close" id="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="entry-detail">
            <div class="detail-item">
              <div class="detail-label">Entry ID</div>
              <div class="detail-value" id="modal-id"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Title</div>
              <div class="detail-value" id="modal-title"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Address 1 (Ethereum)</div>
              <div class="detail-value" id="modal-address1"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Address 2</div>
              <div class="detail-value" id="modal-address2"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Notes</div>
              <div class="detail-value" id="modal-notes"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Additional Information</div>
              <div class="detail-value" id="modal-etcInfo"></div>
            </div>

            <div class="detail-item">
              <div class="detail-label">Exists</div>
              <div class="detail-value" id="modal-exists"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
      <i class="fas fa-check-circle"></i>
      <span id="notification-text">Operation completed successfully!</span>
    </div>

    <script src="./ethers.js"></script>

    <script type="module">
      // Contract ABI
      const contractABI = [
        { inputs: [], stateMutability: "nonpayable", type: "constructor" },
        {
          anonymous: false,
          inputs: [
            {
              indexed: true,
              internalType: "uint256",
              name: "id",
              type: "uint256",
            },
          ],
          name: "EntryCreated",
          type: "event",
        },
        {
          anonymous: false,
          inputs: [
            {
              indexed: true,
              internalType: "uint256",
              name: "id",
              type: "uint256",
            },
          ],
          name: "EntryUpdated",
          type: "event",
        },
        {
          inputs: [
            { internalType: "string", name: "_title", type: "string" },
            { internalType: "address", name: "_address1", type: "address" },
            { internalType: "string", name: "_address2", type: "string" },
            { internalType: "string", name: "_notes", type: "string" },
            { internalType: "string", name: "_etcInfo", type: "string" },
          ],
          name: "createEntry",
          outputs: [],
          stateMutability: "nonpayable",
          type: "function",
        },
        {
          inputs: [],
          name: "getAllEntries",
          outputs: [
            {
              components: [
                { internalType: "uint256", name: "id", type: "uint256" },
                { internalType: "string", name: "title", type: "string" },
                { internalType: "address", name: "address1", type: "address" },
                { internalType: "string", name: "address2", type: "string" },
                { internalType: "string", name: "notes", type: "string" },
                { internalType: "string", name: "etcInfo", type: "string" },
                { internalType: "bool", name: "exists", type: "bool" },
              ],
              internalType: "struct WalletNotebook.Entry[]",
              name: "",
              type: "tuple[]",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [{ internalType: "uint256", name: "_id", type: "uint256" }],
          name: "getEntry",
          outputs: [
            {
              components: [
                { internalType: "uint256", name: "id", type: "uint256" },
                { internalType: "string", name: "title", type: "string" },
                { internalType: "address", name: "address1", type: "address" },
                { internalType: "string", name: "address2", type: "string" },
                { internalType: "string", name: "notes", type: "string" },
                { internalType: "string", name: "etcInfo", type: "string" },
                { internalType: "bool", name: "exists", type: "bool" },
              ],
              internalType: "struct WalletNotebook.Entry",
              name: "",
              type: "tuple",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [],
          name: "owner",
          outputs: [{ internalType: "address", name: "", type: "address" }],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [
            { internalType: "uint256", name: "_id", type: "uint256" },
            { internalType: "string", name: "_notes", type: "string" },
            { internalType: "string", name: "_etcInfo", type: "string" },
          ],
          name: "updateEntry",
          outputs: [],
          stateMutability: "nonpayable",
          type: "function",
        },
      ];

      // Global variables
      let contractAddress = "0x1d0f353a538CD2Cd442e0d240e2814934d8c29e8";
      let contract = null;
      let provider = null;
      let signer = null;
      let userAddress = null;
      let networkName = "Not Connected";

      // DOM elements
      let connectWalletBtn,
        networkNameElement,
        totalEntriesElement,
        contractOwnerElement;
      let connectedAddressElement,
        lastUpdatedElement,
        entriesTableBody,
        notification;
      let notificationText, refreshEntriesBtn, refreshDataBtn, loadEntryBtn;
      let updateEntryForm,
        updateEntryDetails,
        createEntryForm,
        entryModal,
        closeModalBtn;
      let navItems, contentSections, quickActionButtons;

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        initializeDOMElements();
        initNavigation();
        initEventListeners();
        checkEthereumAvailability();
        updateUI();
      });

      // Initialize DOM elements
      function initializeDOMElements() {
        connectWalletBtn = document.getElementById("connect-wallet");
        networkNameElement = document.getElementById("network-name");
        totalEntriesElement = document.getElementById("total-entries");
        contractOwnerElement = document.getElementById("contract-owner");
        connectedAddressElement = document.getElementById("connected-address");
        lastUpdatedElement = document.getElementById("last-updated");
        entriesTableBody = document.getElementById("entries-table-body");
        notification = document.getElementById("notification");
        notificationText = document.getElementById("notification-text");
        refreshEntriesBtn = document.getElementById("refresh-entries");
        refreshDataBtn = document.getElementById("refresh-data");
        loadEntryBtn = document.getElementById("load-entry-btn");
        updateEntryForm = document.getElementById("update-entry-form");
        updateEntryDetails = document.getElementById("update-entry-details");
        createEntryForm = document.getElementById("create-entry-form");
        entryModal = document.getElementById("entry-modal");
        closeModalBtn = document.getElementById("close-modal");
        navItems = document.querySelectorAll(".nav-item");
        contentSections = document.querySelectorAll(".content-section");
        quickActionButtons = document.querySelectorAll("[data-section]");
      }

      // Initialize navigation
      function initNavigation() {
        navItems.forEach((item) => {
          item.addEventListener("click", function () {
            const sectionId = this.getAttribute("data-section");

            // Update active nav item
            navItems.forEach((nav) => nav.classList.remove("active"));
            this.classList.add("active");

            // Show corresponding section
            contentSections.forEach((section) => {
              section.classList.remove("active");
              if (section.id === sectionId) {
                section.classList.add("active");
              }
            });

            // If we're viewing entries, refresh them
            if (sectionId === "view-entries") {
              loadAllEntries();
            }
          });
        });

        // Quick action buttons
        quickActionButtons.forEach((button) => {
          if (button.hasAttribute("data-section") && !button.id) {
            button.addEventListener("click", function () {
              const sectionId = this.getAttribute("data-section");

              // Update active nav item
              navItems.forEach((nav) => {
                nav.classList.remove("active");
                if (nav.getAttribute("data-section") === sectionId) {
                  nav.classList.add("active");
                }
              });

              // Show corresponding section
              contentSections.forEach((section) => {
                section.classList.remove("active");
                if (section.id === sectionId) {
                  section.classList.add("active");
                }
              });

              // If we're viewing entries, refresh them
              if (sectionId === "view-entries") {
                loadAllEntries();
              }
            });
          }
        });
      }

      // Initialize event listeners
      function initEventListeners() {
        if (connectWalletBtn) {
          connectWalletBtn.addEventListener("click", connectWallet);
        }

        if (refreshEntriesBtn) {
          refreshEntriesBtn.addEventListener("click", loadAllEntries);
        }

        if (refreshDataBtn) {
          refreshDataBtn.addEventListener("click", refreshAllData);
        }

        if (loadEntryBtn) {
          loadEntryBtn.addEventListener("click", () => loadEntryForUpdate());
        }

        if (createEntryForm) {
          createEntryForm.addEventListener("submit", createNewEntry);
        }

        if (updateEntryForm) {
          updateEntryForm.addEventListener("submit", updateExistingEntry);
        }

        if (closeModalBtn) {
          closeModalBtn.addEventListener("click", () => {
            if (entryModal) {
              entryModal.classList.remove("active");
            }
          });
        }

        // Close modal when clicking outside
        window.addEventListener("click", (e) => {
          if (entryModal && e.target === entryModal) {
            entryModal.classList.remove("active");
          }
        });
      }

      // Check if Ethereum is available
      function checkEthereumAvailability() {
        if (window.ethereum) {
          console.log("Ethereum wallet detected");
          if (networkNameElement) {
            networkNameElement.textContent = "Ethereum Detected";
            networkNameElement.style.color = "#4cc9f0";
          }
        } else {
          console.log("No Ethereum wallet detected");
          if (networkNameElement) {
            networkNameElement.textContent = "No Wallet Found";
            networkNameElement.style.color = "#f72585";
          }
          if (connectWalletBtn) {
            connectWalletBtn.innerHTML =
              '<i class="fas fa-exclamation-triangle"></i> Install MetaMask';
            connectWalletBtn.disabled = true;
            connectWalletBtn.style.backgroundColor = "#6c757d";
          }
        }
      }

      // arbitrum network switch code
      async function switchToArbitrum() {
        if (!window.ethereum) {
          showNotification("MetaMask is not installed", "error");
          return;
        }

        const arbitrumChainId = "0xa4b1"; // 42161 in hex

        try {
          await window.ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: arbitrumChainId }],
          });

          showNotification("Switched to Arbitrum network", "success");

        } catch (switchError) {
          // This error code means the chain has not been added to MetaMask
          if (switchError.code === 4902) {
            try {
              await window.ethereum.request({
                method: "wallet_addEthereumChain",
                params: [
                  {
                    chainId: arbitrumChainId,
                    chainName: "Arbitrum One",
                    rpcUrls: ["https://arb1.arbitrum.io/rpc"],
                    nativeCurrency: {
                      name: "Ether",
                      symbol: "ETH",
                      decimals: 18,
                    },
                    blockExplorerUrls: ["https://arbiscan.io"],
                  },
                ],
              });

              showNotification("Arbitrum network added and switched", "success");

            } catch (addError) {
              console.error("Failed to add Arbitrum:", addError);
              showNotification("Failed to add Arbitrum network", "error");
            }
          } else {
            console.error("Failed to switch network:", switchError);
            showNotification("Failed to switch to Arbitrum", "error");
          }
        }
      }


      // Connect wallet
      async function connectWallet() {
        if (!window.ethereum) {
          showNotification(
            "Please install MetaMask to use this application",
            "error"
          );
          return;
        }

        try {
          // Request account access
          const accounts = await window.ethereum.request({
            method: "eth_requestAccounts",
          });
          userAddress = accounts[0];

          // Initialize ethers provider and signer
          provider = new ethers.BrowserProvider(window.ethereum);
          signer = await provider.getSigner();

          await switchToArbitrum()

          // Get network
          const network = await provider.getNetwork();
          const chainId = network.chainId.toString();
          networkName =
            network.name === "homestead"
              ? "Ethereum Mainnet"
              : network.name === "goerli"
              ? "Goerli Testnet"
              : network.name === "sepolia"
              ? "Sepolia Testnet"
              : `Chain ID: ${chainId}`;

          // Update UI
          if (networkNameElement) {
            networkNameElement.textContent = networkName;
          }
          if (connectedAddressElement) {
            connectedAddressElement.textContent = shortenAddress(userAddress);
          }

          // Contract address
          const inputAddress = contractAddress;

          if (!inputAddress || !inputAddress.startsWith("0x")) {
            showNotification("Please enter a valid contract address", "error");
            return;
          }

          contractAddress = inputAddress;

          // Initialize contract
          contract = new ethers.Contract(contractAddress, contractABI, signer);

          // Update UI elements
          await updateContractInfo();
          await loadAllEntries();

          // Change connect button
          if (connectWalletBtn) {
            connectWalletBtn.innerHTML =
              '<i class="fas fa-check"></i> Connected';
            connectWalletBtn.style.backgroundColor = "#4cc9f0";
          }

          showNotification("Wallet connected successfully!", "success");

          // Listen for account changes
          window.ethereum.on("accountsChanged", async (accounts) => {
            if (accounts.length === 0) {
              resetConnection();
            } else {
              userAddress = accounts[0];
              if (connectedAddressElement) {
                connectedAddressElement.textContent =
                  shortenAddress(userAddress);
              }
              await updateContractInfo();
            }
          });

          // Listen for network changes
          window.ethereum.on("chainChanged", () => {
            window.location.reload();
          });
        } catch (error) {
          console.error("Error connecting wallet:", error);
          showNotification(
            "Failed to connect wallet: " + error.message,
            "error"
          );
        }
      }

      // Reset connection
      function resetConnection() {
        userAddress = null;
        contract = null;
        networkName = "Not Connected";

        if (networkNameElement) networkNameElement.textContent = networkName;
        if (connectedAddressElement)
          connectedAddressElement.textContent = "Not Connected";
        if (contractOwnerElement) contractOwnerElement.textContent = "...";
        if (totalEntriesElement) totalEntriesElement.textContent = "0";

        if (connectWalletBtn) {
          connectWalletBtn.innerHTML =
            '<i class="fas fa-plug"></i> Connect Wallet';
          connectWalletBtn.style.backgroundColor = "";
        }

        // Clear entries table
        if (entriesTableBody) {
          entriesTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <div style="color: var(--gray);">
                                <i class="fas fa-wallet" style="font-size: 24px; margin-bottom: 15px;"></i>
                                <div>Connect wallet to view entries</div>
                            </div>
                        </td>
                    </tr>
                `;
        }
      }

      // Update contract information
      async function updateContractInfo() {
        if (!contract) return;

        try {
          // Get contract owner
          const owner = await contract.owner();
          if (contractOwnerElement) {
            contractOwnerElement.textContent = shortenAddress(owner);
          }
          const infoOwnerElement = document.getElementById(
            "info-contract-owner"
          );
          if (infoOwnerElement) {
            infoOwnerElement.textContent = shortenAddress(owner);
          }

          // Get total entries
          const allEntries = await contract.getAllEntries();
          if (totalEntriesElement) {
            totalEntriesElement.textContent = allEntries.length;
          }

          // Update other info elements
          const contractAddressElement =
            document.getElementById("contract-address");
          if (contractAddressElement) {
            contractAddressElement.textContent = contractAddress;
          }

          const infoConnectedElement = document.getElementById(
            "info-connected-address"
          );
          if (infoConnectedElement) {
            infoConnectedElement.textContent = shortenAddress(userAddress);
          }

          const infoNetworkElement =
            document.getElementById("info-network-name");
          if (infoNetworkElement) {
            infoNetworkElement.textContent = networkName;
          }

          // Update last updated
          const now = new Date();
          if (lastUpdatedElement) {
            lastUpdatedElement.textContent = now.toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
            });
          }
        } catch (error) {
          console.error("Error updating contract info:", error);
          showNotification("Failed to load contract information", "error");
        }
      }

      // get notes format
      function renderNotes(value) {
        function parseArrayStrings() {
          if (
            typeof value === "string" &&
            value.trim().startsWith("[") &&
            value.trim().endsWith("]")
          ) {
            try {
              return JSON.parse(value.replace(/'/g, '"'));
            } catch (e) {
              return value;
            }
          }
          return value;
        }

        const result = parseArrayStrings();

        if (Array.isArray(result)) {
          return result
            .map((item) => `<span class="badge">${escapeHtml(item)}</span>`)
            .join(" ");
        } else {
          return result;
        }
      }

      // Load all entries
      async function loadAllEntries() {
        if (!contract) {
          showNotification("Please connect wallet first", "warning");
          return;
        }

        if (!entriesTableBody) return;

        try {
          entriesTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <div style="color: var(--gray);">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 15px;"></i>
                                <div>Loading entries...</div>
                            </div>
                        </td>
                    </tr>
                `;

          const allEntries = await contract.getAllEntries();

          if (allEntries.length === 0) {
            entriesTableBody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px;">
                                <div style="color: var(--gray);">
                                    <i class="fas fa-inbox" style="font-size: 24px; margin-bottom: 15px;"></i>
                                    <div>No entries found. Create your first entry!</div>
                                </div>
                            </td>
                        </tr>
                    `;
            if (totalEntriesElement) {
              totalEntriesElement.textContent = "0";
            }
            return;
          }

          // Update total entries count
          if (totalEntriesElement) {
            totalEntriesElement.textContent = allEntries.length;
          }

          // Build table rows
          let tableHTML = "";

          allEntries.forEach((entry) => {
            if (!entry.exists) return;

            const entryId = entry.id.toString();
            tableHTML += `
                        <tr>
                            <td>${entryId}</td>
                            <td>${escapeHtml(entry.title || "Untitled")}</td>
                            <td>${shortenAddress(entry.address1)}</td>
                            <td>${
                              shortenAddress(entry.address2)
                                ? escapeHtml(shortenAddress(entry.address2))
                                : "N/A"
                            }</td>
                            <td class="badge-cell">${renderNotes(
                              entry.notes
                            )}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn view" onclick="viewEntryDetails(${entryId})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn edit" onclick="loadEntryForUpdate(${entryId})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
          });

          entriesTableBody.innerHTML = tableHTML;

          // Update last updated time
          const now = new Date();
          if (lastUpdatedElement) {
            lastUpdatedElement.textContent = now.toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
            });
          }

          showNotification(`Loaded ${allEntries.length} entries`, "success");
        } catch (error) {
          console.error("Error loading entries:", error);
          entriesTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 15px;"></i>
                            <div>Failed to load entries: ${escapeHtml(
                              error.message
                            )}</div>
                        </td>
                    </tr>
                `;
          showNotification("Failed to load entries: " + error.message, "error");
        }
      }

      // View entry details
      async function viewEntryDetails(entryId) {
        if (!contract) {
          showNotification("Please connect wallet first", "warning");
          return;
        }

        try {
          const entry = await contract.getEntry(entryId);

          if (!entry.exists) {
            showNotification(
              `Entry with ID ${entryId} does not exist`,
              "error"
            );
            return;
          }

          // Populate modal
          const modalId = document.getElementById("modal-id");
          const modalTitle = document.getElementById("modal-title");
          const modalAddress1 = document.getElementById("modal-address1");
          const modalAddress2 = document.getElementById("modal-address2");
          const modalNotes = document.getElementById("modal-notes");
          const modalEtcInfo = document.getElementById("modal-etcInfo");
          const modalExists = document.getElementById("modal-exists");

          if (modalId) modalId.textContent = entry.id.toString();
          if (modalTitle) modalTitle.textContent = entry.title || "Untitled";
          if (modalAddress1) modalAddress1.textContent = entry.address1;
          if (modalAddress2)
            modalAddress2.textContent = entry.address2 || "N/A";
          if (modalNotes)
            modalNotes.innerHTML =
              renderNotes(entry.notes) + `<br> <div>${entry.notes}</div>` ||
              "No notes";
          if (modalEtcInfo)
            modalEtcInfo.textContent = entry.etcInfo || "No additional info";
          if (modalExists)
            modalExists.textContent = entry.exists ? "Yes" : "No";

          // Show modal
          if (entryModal) {
            entryModal.classList.add("active");
          }
        } catch (error) {
          console.error("Error loading entry details:", error);
          showNotification(
            "Failed to load entry details: " + error.message,
            "error"
          );
        }
      }

      // Load entry for update
      async function loadEntryForUpdate(entryId = null) {
        if (!contract) {
          showNotification("Please connect wallet first", "warning");
          return;
        }

        // If entryId is not provided, get it from the input field
        if (!entryId && entryId !== 0) {
          const inputElement = document.getElementById("update-entry-id");
          if (inputElement) {
            const inputValue = inputElement.value;

            if (!inputValue || inputValue.trim() === "") {
              showNotification("Please enter an entry ID", "warning");
              return;
            }

            entryId = parseInt(inputValue);
          } else {
            showNotification("Could not find entry ID input", "error");
            return;
          }
        }

        try {
          const entry = await contract.getEntry(entryId);

          if (!entry.exists) {
            showNotification(
              `Entry with ID ${entryId} does not exist`,
              "error"
            );
            return;
          }

          // Populate display fields
          const displayTitle = document.getElementById("update-display-title");
          const displayAddress1 = document.getElementById(
            "update-display-address1"
          );
          const displayAddress2 = document.getElementById(
            "update-display-address2"
          );

          if (displayTitle)
            displayTitle.textContent = entry.title || "Untitled";
          if (displayAddress1) displayAddress1.textContent = entry.address1;
          if (displayAddress2)
            displayAddress2.textContent = entry.address2 || "N/A";

          // Populate form fields
          const notesInput = document.getElementById("update-notes");
          const etcInfoInput = document.getElementById("update-etcInfo");

          if (notesInput) notesInput.value = entry.notes || "";
          if (etcInfoInput) etcInfoInput.value = entry.etcInfo || "";

          // Set the entry ID in the form for reference
          if (updateEntryForm) {
            updateEntryForm.dataset.entryId = entryId;
          }

          // Show the update form
          if (updateEntryDetails) {
            updateEntryDetails.style.display = "block";
          }

          // Navigate to update section
          navItems.forEach((nav) => nav.classList.remove("active"));
          const updateNavItem = document.querySelector(
            '.nav-item[data-section="update-entry"]'
          );
          if (updateNavItem) {
            updateNavItem.classList.add("active");
          }

          contentSections.forEach((section) => {
            section.classList.remove("active");
            if (section.id === "update-entry") {
              section.classList.add("active");
            }
          });

          showNotification(`Loaded entry #${entryId} for editing`, "success");
        } catch (error) {
          console.error("Error loading entry for update:", error);
          showNotification("Failed to load entry: " + error.message, "error");
        }
      }

      // Create new entry
      async function createNewEntry(e) {
        e.preventDefault();

        if (!contract) {
          showNotification("Please connect wallet first", "warning");
          return;
        }

        const titleInput = document.getElementById("create-title");
        const address1Input = document.getElementById("create-address1");
        const address2Input = document.getElementById("create-address2");
        const notesInput = document.getElementById("create-notes");
        const etcInfoInput = document.getElementById("create-etcInfo");

        if (!titleInput || !address1Input) {
          showNotification("Form inputs not found", "error");
          return;
        }

        const title = titleInput.value;
        const address1 = address1Input.value;
        const address2 = address2Input ? address2Input.value : "";
        const notes = notesInput ? notesInput.value : "";
        const etcInfo = etcInfoInput ? etcInfoInput.value : "";

        // Basic validation
        if (!title || !address1) {
          showNotification("Title and Address 1 are required", "error");
          return;
        }

        // Validate Ethereum address
        if (!ethers.isAddress(address1)) {
          showNotification(
            "Please enter a valid Ethereum address for Address 1",
            "error"
          );
          return;
        }

        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn ? submitBtn.innerHTML : "";

        try {
          // Show loading state
          if (submitBtn) {
            submitBtn.innerHTML = '<div class="spinner"></div> Creating...';
            submitBtn.disabled = true;
          }

          // Call contract function
          const tx = await contract.createEntry(
            title,
            address1,
            address2,
            notes,
            etcInfo
          );

          showNotification(
            "Transaction sent. Waiting for confirmation...",
            "info"
          );

          // Wait for transaction to be mined
          await tx.wait();

          // Reset form
          if (createEntryForm) {
            createEntryForm.reset();
          }

          // Update UI
          await updateContractInfo();
          await loadAllEntries();

          showNotification("Entry created successfully!", "success");

          // Navigate to view entries
          navItems.forEach((nav) => nav.classList.remove("active"));
          const viewNavItem = document.querySelector(
            '.nav-item[data-section="view-entries"]'
          );
          if (viewNavItem) {
            viewNavItem.classList.add("active");
          }

          contentSections.forEach((section) => {
            section.classList.remove("active");
            if (section.id === "view-entries") {
              section.classList.add("active");
            }
          });
        } catch (error) {
          console.error("Error creating entry:", error);
          showNotification("Failed to create entry: " + error.message, "error");
        } finally {
          // Reset button state
          if (submitBtn) {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          }
        }
      }

      // Update existing entry
      async function updateExistingEntry(e) {
        e.preventDefault();

        if (!contract) {
          showNotification("Please connect wallet first", "warning");
          return;
        }

        const entryId = parseInt(e.target.dataset.entryId);

        const notesInput = document.getElementById("update-notes");
        const etcInfoInput = document.getElementById("update-etcInfo");

        const notes = notesInput ? notesInput.value : "";
        const etcInfo = etcInfoInput ? etcInfoInput.value : "";

        if (isNaN(entryId)) {
          showNotification("Invalid entry ID", "error");
          return;
        }

        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn ? submitBtn.innerHTML : "";

        try {
          // Show loading state
          if (submitBtn) {
            submitBtn.innerHTML = '<div class="spinner"></div> Updating...';
            submitBtn.disabled = true;
          }

          // Call contract function
          const tx = await contract.updateEntry(entryId, notes, etcInfo);

          showNotification(
            "Transaction sent. Waiting for confirmation...",
            "info"
          );

          // Wait for transaction to be mined
          await tx.wait();

          // Reset form
          if (updateEntryForm) {
            updateEntryForm.reset();
          }
          if (updateEntryDetails) {
            updateEntryDetails.style.display = "none";
          }

          // Update UI
          await updateContractInfo();
          await loadAllEntries();

          showNotification(
            `Entry #${entryId} updated successfully!`,
            "success"
          );

          // Navigate to view entries
          navItems.forEach((nav) => nav.classList.remove("active"));
          const viewNavItem = document.querySelector(
            '.nav-item[data-section="view-entries"]'
          );
          if (viewNavItem) {
            viewNavItem.classList.add("active");
          }

          contentSections.forEach((section) => {
            section.classList.remove("active");
            if (section.id === "view-entries") {
              section.classList.add("active");
            }
          });
        } catch (error) {
          console.error("Error updating entry:", error);
          showNotification("Failed to update entry: " + error.message, "error");
        } finally {
          // Reset button state
          if (submitBtn) {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          }
        }
      }

      // Refresh all data
      async function refreshAllData() {
        if (!contract) {
          showNotification("Please connect wallet first", "warning");
          return;
        }

        try {
          await updateContractInfo();
          await loadAllEntries();
          showNotification("Data refreshed successfully!", "success");
        } catch (error) {
          console.error("Error refreshing data:", error);
          showNotification("Failed to refresh data: " + error.message, "error");
        }
      }

      // Show notification
      function showNotification(message, type = "info") {
        if (!notification || !notificationText) return;

        // Set notification content and style
        notificationText.textContent = message;
        notification.className = `notification ${type}`;

        // Set icon based on type
        const icon = notification.querySelector("i");
        if (icon) {
          icon.className =
            type === "success"
              ? "fas fa-check-circle"
              : type === "error"
              ? "fas fa-exclamation-circle"
              : type === "warning"
              ? "fas fa-exclamation-triangle"
              : "fas fa-info-circle";
        }

        // Show notification
        notification.classList.add("show");

        // Hide after 5 seconds
        setTimeout(() => {
          notification.classList.remove("show");
        }, 5000);
      }

      // Update UI based on connection state
      function updateUI() {
        // Set initial state
        if (networkNameElement)
          networkNameElement.textContent = "Not Connected";
        if (connectedAddressElement)
          connectedAddressElement.textContent = "Not Connected";
        if (contractOwnerElement) contractOwnerElement.textContent = "...";
        if (totalEntriesElement) totalEntriesElement.textContent = "0";

        // Set current date/time
        const now = new Date();
        if (lastUpdatedElement) {
          lastUpdatedElement.textContent = now.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });
        }
      }

      // Utility function to shorten addresses
      function shortenAddress(address) {
        if (!address || address.length < 10) return address || "";
        return `${address.substring(0, 6)}...${address.substring(
          address.length - 5
        )}`;
      }

      // Utility function to shorten strings
      function shortenString(str, maxLength) {
        if (!str) return "";
        if (str.length <= maxLength) return str;
        return `${str.substring(0, maxLength)}...`;
      }

      // Utility function to escape HTML
      function escapeHtml(text) {
        const map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        };
        return text.replace(/[&<>"']/g, (m) => map[m]);
      }

      // Make functions available globally for onclick handlers
      window.viewEntryDetails = viewEntryDetails;
      window.loadEntryForUpdate = loadEntryForUpdate;
    </script>
  </body>
</html>
